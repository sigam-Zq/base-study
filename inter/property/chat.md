# é—®

åœ¨goè¯­è¨€ä¸­

type ReadWriter interface {
	~string | ~[]rune

	Read(p []byte) (n int, err error)
	Write(p []byte) (n int, err error)
}

func TestXxx(t *testing.T) {
   var a ReadWriter
}

è¿™é‡Œ  var a ReadWriter ä¸­çš„ ReadWriter åœ¨gopls æ£€æŸ¥ä»£ç ä¸­æ˜¾ç¤ºæœ‰é”™è¯¯

cannot use type ReadWriter outside a type constraint: interface contains type constraints

1. è¿™é‡Œè¦æ€ä¹ˆé¿å…è¿™é‡Œçš„æŠ¥é”™ 
2. ReadWriter  è¿™ä¸ªæ¥å£ è¦æ€ä¹ˆä½¿ç”¨
3.  interface  å£°æ˜ä½“å†…ä½¿ç”¨ åŸºç¡€ç±»å‹ stringä¹‹ç±»   è¿™é‡Œå…·ä½“æœ‰ä»€ä¹ˆä½œç”¨å’Œæ•ˆæœï¼Œå…¶ä¸­çš„ ~ å’Œ  | åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨å’Œæ„ä¹‰


# ç­”

### ğŸ’¡ **1. å¦‚ä½•é¿å… `cannot use type ReadWriter outside a type constraint` æŠ¥é”™**

åœ¨ Go ä¸­ï¼Œ`gopls` æŠ¥é”™ `cannot use type ReadWriter outside a type constraint` çš„åŸå› æ˜¯ï¼š
- ä½ å°†**å¸¦æœ‰ç±»å‹çº¦æŸ**çš„æ¥å£ï¼ˆ`ReadWriter`ï¼‰å½“ä½œæ™®é€šæ¥å£åœ¨å˜é‡å£°æ˜ä¸­ä½¿ç”¨ã€‚
- å¸¦æœ‰ç±»å‹çº¦æŸçš„æ¥å£åªèƒ½ç”¨ä½œ**æ³›å‹çº¦æŸ**ï¼Œä¸èƒ½ç›´æ¥ä½œä¸ºæ™®é€šå˜é‡ç±»å‹ä½¿ç”¨ã€‚

âœ… **è§£å†³æ–¹æ¡ˆï¼š**

å°† `ReadWriter` ç”¨ä½œæ³›å‹çº¦æŸï¼š
```go
func TestXxx[T ReadWriter](t *testing.T) {
	var a T
	// è¿™é‡Œ a å°±ç¬¦åˆ ReadWriter çš„çº¦æŸ
	fmt.Printf("%T\n", a)
}
```
ğŸ“Œ **åŸå› ï¼š**
- `ReadWriter` åŒ…å«äº†ç±»å‹çº¦æŸ `~string | ~[]rune`ï¼Œè¿™ç§æ¥å£åªèƒ½åœ¨**æ³›å‹çº¦æŸ**ä¸­ä½¿ç”¨ï¼Œè€Œä¸èƒ½ä½œä¸ºå˜é‡ç±»å‹ã€‚
- `gopls` ä¼šæ£€æµ‹åˆ°è¿™ç§é”™è¯¯å¹¶æŠ¥é”™ã€‚

---

### ğŸš€ **2. å¦‚ä½•ä½¿ç”¨ `ReadWriter` æ¥å£**

âœ… å¦‚æœä½ æƒ³ä½¿ç”¨ç±»ä¼¼åŠŸèƒ½çš„æ¥å£ç±»å‹ï¼Œä½ éœ€è¦åˆ†å¼€**ç±»å‹çº¦æŸ**å’Œ**è¡Œä¸ºæ¥å£**ï¼š

**æ–¹å¼ä¸€ï¼šå°†çº¦æŸä¸è¡Œä¸ºæ¥å£åˆ†å¼€**
```go
// ç±»å‹çº¦æŸéƒ¨åˆ†
type StringLike interface {
	~string | ~[]rune
}

// è¡Œä¸ºæ¥å£éƒ¨åˆ†
type ReaderWriter interface {
	Read(p []byte) (n int, err error)
	Write(p []byte) (n int, err error)
}

// æ³›å‹å‡½æ•°
func Process[T StringLike](value T) {
	fmt.Println(value)
}
```
ğŸ“Œ è¿™ç§åšæ³•ï¼š
- `StringLike` ä½œä¸ºæ³›å‹çº¦æŸï¼Œç”¨äºæ³›å‹å‚æ•°çº¦æŸã€‚
- `ReaderWriter` æ˜¯æ™®é€šæ¥å£ï¼Œå…·æœ‰ `Read` å’Œ `Write` æ–¹æ³•ï¼Œå¯ä»¥è¢«æ­£å¸¸èµ‹å€¼ä½¿ç”¨ã€‚

---

### âš™ï¸ **3. `~` å’Œ `|` åœ¨æ¥å£ä¸­çš„ä½œç”¨**

âœ… **3.1 `~` è¿ç®—ç¬¦**
- åœ¨ Go 1.18 å¼•å…¥äº†æ³›å‹ï¼Œ`~` ç”¨äºè¡¨ç¤º**åŸºç¡€ç±»å‹çº¦æŸ**ã€‚
- `~T` è¡¨ç¤ºï¼š**æ‰€æœ‰åº•å±‚ç±»å‹ä¸º `T` çš„ç±»å‹**ï¼ŒåŒ…æ‹¬å®šä¹‰åœ¨åˆ«åæˆ–è‡ªå®šä¹‰ç±»å‹ä¸Šçš„ç±»å‹ã€‚

ä¾‹å¦‚ï¼š
```go
type MyString string  // è‡ªå®šä¹‰ç±»å‹ï¼Œåº•å±‚æ˜¯ string

// ~string è¡¨ç¤ºåº•å±‚æ˜¯ string çš„æ‰€æœ‰ç±»å‹
type StringLike interface {
	~string
}

func Print[T StringLike](s T) {
	fmt.Println(s)
}

func main() {
	var a MyString = "hello"
	Print(a)           // âœ… å¯ä»¥ä½¿ç”¨ï¼Œå› ä¸ºåº•å±‚æ˜¯ string
	Print("world")      // âœ… åº•å±‚å°±æ˜¯ string
}
```
ğŸ“Œ **ä½œç”¨**ï¼š
- `~` å¯ä»¥åŒ¹é…åº•å±‚ä¸º `string` çš„è‡ªå®šä¹‰ç±»å‹ï¼Œå¦‚ `MyString`ã€‚
- å¦‚æœä¸ä½¿ç”¨ `~`ï¼Œåˆ™åªèƒ½æ¥å—åŸå§‹ `string` ç±»å‹ï¼Œä¸èƒ½ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹ã€‚

---

âœ… **3.2 `|` è¿ç®—ç¬¦**
- `|` åœ¨æ¥å£ç±»å‹çº¦æŸä¸­è¡¨ç¤º**è”åˆçº¦æŸ**ï¼Œè¡¨ç¤ºå‚æ•°å¯ä»¥æ˜¯å¤šç§ç±»å‹ä¹‹ä¸€ã€‚

ç¤ºä¾‹ï¼š
```go
type Number interface {
	int | float64 | int64
}

func Sum[T Number](a, b T) T {
	return a + b
}
```
- `Number` æ¥å£çº¦æŸäº†æ³›å‹å‚æ•° `T` å¿…é¡»æ˜¯ `int`ã€`float64` æˆ– `int64` ä¸­çš„ä¸€ç§ã€‚
- `|` å°†ä¸åŒç±»å‹è”åˆèµ·æ¥ï¼Œä½œä¸ºçº¦æŸæ¡ä»¶ã€‚

---

### âœ… **æ€»ç»“**
1. **æŠ¥é”™åŸå› åŠè§£å†³æ–¹æ¡ˆ**
   - æŠ¥é”™åŸå› ï¼šå¸¦æœ‰ç±»å‹çº¦æŸçš„æ¥å£ä¸èƒ½ä½œä¸ºæ™®é€šå˜é‡ä½¿ç”¨ã€‚
   - è§£å†³æ–¹æ¡ˆï¼šå°†ç±»å‹çº¦æŸç”¨äºæ³›å‹ä¸­ï¼Œä¸èƒ½ç›´æ¥ç”¨ä½œå˜é‡ç±»å‹ã€‚

2. **å¦‚ä½•ä½¿ç”¨ `ReadWriter`**
   - å°†ç±»å‹çº¦æŸä¸è¡Œä¸ºæ¥å£åˆ†å¼€ä½¿ç”¨ã€‚
   - ä½¿ç”¨æ³›å‹å°†ç±»å‹çº¦æŸä½œä¸ºå‚æ•°çš„çº¦æŸã€‚

3. **`~` å’Œ `|` çš„å«ä¹‰**
   - `~`ï¼šåŒ¹é…**åº•å±‚ç±»å‹**ä¸€è‡´çš„è‡ªå®šä¹‰ç±»å‹ã€‚
   - `|`ï¼šè¡¨ç¤º**è”åˆçº¦æŸ**ï¼ŒåŒ¹é…å¤šä¸ªç±»å‹ã€‚

âœ… Go 1.18 æ³›å‹å¼•å…¥åï¼Œè¿™ç§ç±»å‹çº¦æŸè®©æ¥å£æ›´åŠ çµæ´»ï¼Œä½†è¦æ³¨æ„å…¶ç”¨æ³•ä»…é™äºæ³›å‹çº¦æŸä¸­ï¼Œä¸èƒ½ç›´æ¥ä½œä¸ºå˜é‡ç±»å‹ä½¿ç”¨ã€‚